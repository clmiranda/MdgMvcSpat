@model List<Seguimiento>
@await Html.PartialAsync("~/Views/RenderSweetAlert.cshtml")
<div class="d-lg-flex justify-content-between my-3">
    <form class="form-inline mr-2" method="post" asp-action="ReturnVista" onsubmit="return send(this);">
        <div class="input-group">
            <div class="input-group-prepend">
                <label class="input-group-text" for="idSelectEstado">Filtro:</label>
            </div>
            <select id="idSelectEstado" name="filter" class="custom-select dropdown-toggle mr-2">
                @if (ViewData["filter"].ToString().Equals("Asignado"))
                {
                    <option value="Asignado" selected>Asignado</option>
                    <option value="Pendiente">Pendiente</option>
                }
                else if (ViewData["filter"].ToString().Equals("Pendiente"))
                {
                    <option value="Asignado">Asignado</option>
                    <option value="Pendiente" selected>Pendiente</option>
                }
            </select>
        </div>
        <div class="input-group">
            <div class="input-group-prepend">
                <label class="input-group-text" for="idSelectCantidad">Cantidad:</label>
            </div>
            <select id="idSelectCantidad" name="sizePage" class="custom-select dropdown-toggle mr-2">
                @if (int.Parse(ViewData["itemsPerPage"].ToString()) == 5)
                {
                    <option value="5" selected>5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                }
                else if (int.Parse(ViewData["itemsPerPage"].ToString()) == 10)
                {
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                }
                else if (int.Parse(ViewData["itemsPerPage"].ToString()) == 20)
                {
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                }
                else if (int.Parse(ViewData["itemsPerPage"].ToString()) == 50)
                {
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50" selected>50</option>
                }
            </select>
        </div>
        <button id="resetear" type="submit" class="btn btn-primary">Reiniciar</button>
    </form>
</div>
<div class="table-responsive mt-sm-3 mt-md-5">
    <table id="tableVoluntarioSeguimiento" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>Id</th>
                <th>Rango de Fechas</th>
                <th>Nº de Reportes</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tbodyVoluntarioSeguimiento">
            @if (Model.Count() <= 0)
            {
                <tr>
                    <td colspan="4"><h1 class="text-center">No hay registros para mostrar.</h1></td>
                </tr>
            }
            else
            {
                @foreach (var item in Model)
                {
                    <tr>
                        <td width="3%">
                            @item.Id
                        </td>
                        <td>
                            <p>Desde @item.FechaInicio.ToShortDateString() hasta @item.FechaConclusion.ToShortDateString()</p>
                        </td>
                        <td>
                            @if (item.ReporteSeguimientos == null)
                            {
                                <p>No tiene reportes creados.</p>
                            }
                            else
                            {
                                <p>@item.ReporteSeguimientos.Count() reporte(s).</p>
                            }
                        </td>
                        <td width="10%">
                            @if (item.Estado.Equals("Pendiente"))
                            {
                                <div class="d-flex flex-row">
                                    <form id="asignar-@item.Id" asp-action="Aceptar" asp-route-id="@item.Id" method="post" onsubmit="return jQueryAjaxPostList(this);">
                                        <button type="submit" class="btn btn-primary">Aceptar</button>
                                    </form>
                                    <form id="rechazar-@item.Id" asp-action="Rechazar" asp-route-id="@item.Id" class="d-inline" method="post" onsubmit="return jQueryAjaxPostList(this);">
                                        <button type="submit" class="btn btn-danger">Rechazar</button>
                                    </form>
                                </div>
                            }
                            else if (item.Estado.Equals("Asignado"))
                            {
                                <a role="button" class="btn btn-success" href="@Url.Action("ListaReportes","ReporteVoluntario", new { id=item.Id, area="AdministracionSeguimientos"})">
                                    <i class="fa fa-user" aria-hidden="true"></i>
                                </a>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
        <tfoot>
            <tr>
                <th>Id</th>
                <th>Rango de Fechas</th>
                <th>Nº de Reportes</th>
                <th>Acciones</th>
            </tr>
        </tfoot>
    </table>
</div>
<nav class="table-responsive">
    <form asp-action="ReturnVista" method="post" onsubmit="return send(this);">
        <input type="hidden" name="sizePage" value="@ViewData["itemsPerPage"]" />
        <input type="hidden" name="currentPage" />
        <ul class="pagination justify-content-center d-flex flex-wrap">
            @if (int.Parse(ViewData["currentPage"].ToString()) > 1)
            {
                <li class="page-item">
                    <button class="page-link" value="1" onclick="GetValueButton(this.value)">Primer</button>
                </li>
                <li class="page-item">
                    @{ int p = int.Parse(ViewData["currentPage"].ToString()) - 1;}
                    <button class="page-link" value="@p" onclick="GetValueButton(this.value)">Anterior</button>
                </li>
            }
            else
            {
                <li class="page-item">
                    <button type="button" class="page-link">Primer<span class="sr-only"></span></button>
                </li>
                <li class="page-item">
                    <button type="button" class="page-link">Anterior<span class="sr-only"></span></button>
                </li>
            }

            @for (var pagina = 1; pagina <= int.Parse(ViewData["totalPages"].ToString()); pagina++)
            {
                <li class="page-item @(pagina == int.Parse(ViewData["currentPage"].ToString()) ? "active" : "")">
                    @if (pagina == int.Parse(ViewData["currentPage"].ToString()))
                    {
                        <button type="button" class="page-link" value="@pagina" role="button">@(pagina)<span class="sr-only"></span></button>
                    }
                    else
                    {
                        <button class="page-link" value="@pagina" onclick="GetValueButton(this.value)">@(pagina)</button>
                    }
                </li>
            }

            @if (int.Parse(ViewData["currentPage"].ToString()) < int.Parse(ViewData["totalPages"].ToString()))
            {
                <li class="page-item">
                    @{int n = int.Parse(ViewData["currentPage"].ToString()) + 1;}
                    <button class="page-link" value="@n" onclick="GetValueButton(this.value)">Siguiente</button>
                </li>
                <li class="page-item">
                    <button class="page-link" value="@ViewData["totalPages"]" onclick="GetValueButton(this.value)">&Uacute;ltimo</button>
                </li>
            }
            else
            {
                <li class="page-item">
                    <button type="button" class="page-link">Siguiente<span class="sr-only"></span></button>
                </li>
                <li class="page-item">
                    <button type="button" class="page-link">&Uacute;ltimo<span class="sr-only"></span></button>
                </li>
            }
        </ul>
    </form>
</nav>
<script>
    function GetValueButton(val) {
        $("[name='currentPage']").val(val);
    }
    $("#resetear").on("click", function () {
        $("select[name='filter'] option").val("Asignado");
        $("select[name='sizePage'] option").val("10");
    });
    send = form => {
        $.ajax({
            type: "POST",
            url: form.action,
            data: new FormData(form),
            contentType: false,
            processData: false,
            success: function (res) {
                $('#view-all').html(res);
            }
        })
            .fail(function (jqXHR, textStatus, errorThrown) {
                window.location.href = "/Error/" + jqXHR.status;
            })
        return false;
    };
    $('select').on('change', function () {
        $.ajax({
            type: "POST",
            url: this.form.action,
            data: new FormData(this.form),
            contentType: false,
            processData: false,
            success: function (res) {
                $('#view-all').html(res);
            }
        })
            .fail(function (jqXHR, textStatus, errorThrown) {
                window.location.href = "/Error/" + jqXHR.status;
            })
    });
</script>